/**
 * @file Overview
 * This ruleset is designed for an initial prototyping phase of a material order management application.
 * It prioritizes ease of development and iteration with relaxed data validation while maintaining a secure authorization model.
 *
 * Core Philosophy:
 * The initial version allows full read and write access to facilitate rapid development.
 * However, the structure anticipates the future implementation of user-based access control.
 *
 * Data Structure:
 * Orders are stored in a flat `/pedidos/{pedidoId}` collection.
 *
 * Key Security Decisions:
 * - Data validation is minimal to allow flexible data input during prototyping.
 * - The rules are structured to support future authentication and access control.
 * - No user-specific data segregation is implemented yet; all orders are in a single collection.
 *
 * Future Considerations:
 * - Implement user authentication and role-based access control.
 * - Segregate orders by user (e.g., `/users/{userId}/orders/{orderId}`).
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Manages material orders placed by construction companies.
     * @path /pedidos/{pedidoId}
     * @allow (create) Authenticated user can create a new order.
     * @deny (create) Unauthenticated user cannot create a new order.
     * @allow (get) Authenticated user can retrieve any order.
     * @deny (get) N/A
     * @allow (list) Authenticated user can list all orders.
     * @deny (list) N/A
     * @allow (update) Authenticated user can update any order.
     * @deny (update) Unauthenticated user cannot update an order.
     * @allow (delete) Authenticated user can delete any order.
     * @deny (delete) Unauthenticated user cannot delete an order.
     * @principle Allows any authenticated user to create, read, update, and delete any order.
     */
    match /pedidos/{pedidoId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    // ----- Helper Functions -----
    function isSignedIn() {
      return request.auth != null;
    }
  }
}